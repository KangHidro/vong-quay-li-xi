function Winwheel(e,t){for(let n in defaultOptions={canvasId:'canvas',centerX:null,centerY:null,outerRadius:null,innerRadius:0,numSegments:1,drawMode:'code',rotationAngle:0,textFontFamily:'Arial',textFontSize:20,textFontWeight:'bold',textOrientation:'horizontal',textAlignment:'center',textDirection:'normal',textMargin:null,textFillStyle:'black',textStrokeStyle:null,textLineWidth:1,fillStyle:'silver',strokeStyle:'black',lineWidth:1,clearTheCanvas:!0,imageOverlay:!1,drawText:!0,pointerAngle:0,wheelImage:null,imageDirection:'N',responsive:!1,scaleFactor:1},defaultOptions)this[n]=null!=e&&'undefined'!=typeof e[n]?e[n]:defaultOptions[n];if(null!=e)for(let n in e)'undefined'==typeof this[n]&&(this[n]=e[n]);this.canvasId?(this.canvas=document.getElementById(this.canvasId),this.canvas?(null==this.centerX&&(this.centerX=this.canvas.width/2),null==this.centerY&&(this.centerY=this.canvas.height/2),null==this.outerRadius&&(this.canvas.width<this.canvas.height?this.outerRadius=this.canvas.width/2-this.lineWidth:this.outerRadius=this.canvas.height/2-this.lineWidth),this.ctx=this.canvas.getContext('2d')):(this.canvas=null,this.ctx=null)):(this.canvas=null,this.ctx=null),this.segments=[null];for(let n=1;n<=this.numSegments;n++)this.segments[n]=null!=e&&e.segments&&'undefined'!=typeof e.segments[n-1]?new Segment(e.segments[n-1]):new Segment;if(this.updateSegmentSizes(),null===this.textMargin&&(this.textMargin=this.textFontSize/1.7),this.animation=null!=e&&e.animation&&'undefined'!=typeof e.animation?new Animation(e.animation):new Animation,null!=e&&e.pins&&'undefined'!=typeof e.pins&&(this.pins=new Pin(e.pins)),'image'==this.drawMode||'segmentImage'==this.drawMode?('undefined'==typeof e.fillStyle&&(this.fillStyle=null),'undefined'==typeof e.strokeStyle&&(this.strokeStyle='red'),'undefined'==typeof e.drawText&&(this.drawText=!1),'undefined'==typeof e.lineWidth&&(this.lineWidth=1),'undefined'==typeof t&&(t=!1)):'undefined'==typeof t&&(t=!0),this.pointerGuide=null!=e&&e.pointerGuide&&'undefined'!=typeof e.pointerGuide?new PointerGuide(e.pointerGuide):new PointerGuide,this.responsive&&(winwheelToDrawDuringAnimation=this,this._originalCanvasWidth=this.canvas.width,this._originalCanvasHeight=this.canvas.height,this._responsiveScaleHeight=this.canvas.dataset.responsivescaleheight,this._responsiveMinWidth=this.canvas.dataset.responsiveminwidth,this._responsiveMinHeight=this.canvas.dataset.responsiveminheight,this._responsiveMargin=this.canvas.dataset.responsivemargin,window.addEventListener('load',winwheelResize),window.addEventListener('resize',winwheelResize)),!0==t)this.draw(this.clearTheCanvas);else if('segmentImage'==this.drawMode){winwheelToDrawDuringAnimation=this,winhweelAlreadyDrawn=!1;for(let n=1;n<=this.numSegments;n++)null!==this.segments[n].image&&(this.segments[n].imgData=new Image,this.segments[n].imgData.onload=winwheelLoadedImage,this.segments[n].imgData.src=this.segments[n].image)}}Winwheel.prototype.updateSegmentSizes=function(){if(this.segments){let e=0,t=0;for(let r=1;r<=this.numSegments;r++)null!==this.segments[r].size&&(e+=this.segments[r].size,t++);let n=360-e,a=0;0<n&&(a=n/(this.numSegments-t));let o=0;for(let r=1;r<=this.numSegments;r++)this.segments[r].startAngle=o,o+=this.segments[r].size?this.segments[r].size:a,this.segments[r].endAngle=o}},Winwheel.prototype.clearCanvas=function(){this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},Winwheel.prototype.draw=function(e){this.ctx&&('undefined'==typeof e?this.clearCanvas():!0==e&&this.clearCanvas(),'image'==this.drawMode?(this.drawWheelImage(),!0==this.drawText&&this.drawSegmentText(),!0==this.imageOverlay&&this.drawSegments()):'segmentImage'==this.drawMode?(this.drawSegmentImages(),!0==this.drawText&&this.drawSegmentText(),!0==this.imageOverlay&&this.drawSegments()):(this.drawSegments(),!0==this.drawText&&this.drawSegmentText()),'undefined'!=typeof this.pins&&!0==this.pins.visible&&this.drawPins(),!0==this.pointerGuide.display&&this.drawPointerGuide())},Winwheel.prototype.drawPins=function(){if(this.pins&&this.pins.number){let e=this.centerX*this.scaleFactor,t=this.centerY*this.scaleFactor,n=this.outerRadius*this.scaleFactor,a=this.pins.outerRadius,o=this.pins.margin;this.pins.responsive&&(a=this.pins.outerRadius*this.scaleFactor,o=this.pins.margin*this.scaleFactor);let r=360/this.pins.number;for(let s=1;s<=this.pins.number;s++)this.ctx.save(),this.ctx.strokeStyle=this.pins.strokeStyle,this.ctx.lineWidth=this.pins.lineWidth,this.ctx.fillStyle=this.pins.fillStyle,this.ctx.translate(e,t),this.ctx.rotate(this.degToRad(s*r+this.rotationAngle)),this.ctx.translate(-e,-t),this.ctx.beginPath(),this.ctx.arc(e,t-n+a+o,a,0,2*Math.PI),this.pins.fillStyle&&this.ctx.fill(),this.pins.strokeStyle&&this.ctx.stroke(),this.ctx.restore()}},Winwheel.prototype.drawPointerGuide=function(){if(this.ctx){let e=this.centerX*this.scaleFactor,t=this.centerY*this.scaleFactor,n=this.outerRadius*this.scaleFactor;this.ctx.save(),this.ctx.translate(e,t),this.ctx.rotate(this.degToRad(this.pointerAngle)),this.ctx.translate(-e,-t),this.ctx.strokeStyle=this.pointerGuide.strokeStyle,this.ctx.lineWidth=this.pointerGuide.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e,-(n/4)),this.ctx.stroke(),this.ctx.restore()}},Winwheel.prototype.drawWheelImage=function(){if(null!=this.wheelImage){let e=this.centerX*this.scaleFactor,t=this.centerY*this.scaleFactor,n=this.wheelImage.width*this.scaleFactor,a=this.wheelImage.height*this.scaleFactor;this.ctx.save(),this.ctx.translate(e,t),this.ctx.rotate(this.degToRad(this.rotationAngle)),this.ctx.translate(-e,-t),this.ctx.drawImage(this.wheelImage,e-n/2,t-a/2,n,a),this.ctx.restore()}},Winwheel.prototype.drawSegmentImages=function(){if(this.ctx){let e=this.centerX*this.scaleFactor,t=this.centerY*this.scaleFactor;if(this.segments)for(let a,n=1;n<=this.numSegments;n++)if(a=this.segments[n],a.imgData.height){let o=0,r=0,s=0,l='',g=a.imgData.width*this.scaleFactor,m=a.imgData.height*this.scaleFactor;l=null===a.imageDirection?this.imageDirection:a.imageDirection,'S'==l?(o=e-g/2,r=t,s=a.startAngle+180+(a.endAngle-a.startAngle)/2):'E'==l?(o=e,r=t-m/2,s=a.startAngle+270+(a.endAngle-a.startAngle)/2):'W'==l?(o=e-g,r=t-m/2,s=a.startAngle+90+(a.endAngle-a.startAngle)/2):(o=e-g/2,r=t-m,s=a.startAngle+(a.endAngle-a.startAngle)/2),this.ctx.save(),this.ctx.translate(e,t),this.ctx.rotate(this.degToRad(this.rotationAngle+s)),this.ctx.translate(-e,-t),this.ctx.drawImage(a.imgData,o,r,g,m),this.ctx.restore()}else console.log('Segment '+n+' imgData is not loaded')}},Winwheel.prototype.drawSegments=function(){if(this.ctx&&this.segments){let e=this.centerX*this.scaleFactor,t=this.centerY*this.scaleFactor,n=this.innerRadius*this.scaleFactor,a=this.outerRadius*this.scaleFactor;for(let o=1;o<=this.numSegments;o++){let s,l,g,r=this.segments[o];if(s=null===r.fillStyle?this.fillStyle:r.fillStyle,this.ctx.fillStyle=s,l=null===r.lineWidth?this.lineWidth:r.lineWidth,this.ctx.lineWidth=l,g=null===r.strokeStyle?this.strokeStyle:r.strokeStyle,this.ctx.strokeStyle=g,g||s){if(this.ctx.beginPath(),!this.innerRadius)this.ctx.moveTo(e,t);else{let m=Math.cos(this.degToRad(r.startAngle+this.rotationAngle-90))*(n-l/2),u=Math.sin(this.degToRad(r.startAngle+this.rotationAngle-90))*(n-l/2);this.ctx.moveTo(e+m,t+u)}this.ctx.arc(e,t,a,this.degToRad(r.startAngle+this.rotationAngle-90),this.degToRad(r.endAngle+this.rotationAngle-90),!1),this.innerRadius?this.ctx.arc(e,t,n,this.degToRad(r.endAngle+this.rotationAngle-90),this.degToRad(r.startAngle+this.rotationAngle-90),!0):this.ctx.lineTo(e,t),s&&this.ctx.fill(),g&&this.ctx.stroke()}}}},Winwheel.prototype.drawSegmentText=function(){if(this.ctx){let e,t,n,a,o,r,s,l,g,m,p=this.centerX*this.scaleFactor,f=this.centerY*this.scaleFactor,h=this.outerRadius*this.scaleFactor,A=this.innerRadius*this.scaleFactor;for(let S=1;S<=this.numSegments;S++){this.ctx.save();let v=this.segments[S];if(v.text){e=null===v.textFontFamily?this.textFontFamily:v.textFontFamily,t=null===v.textFontSize?this.textFontSize:v.textFontSize,n=null===v.textFontWeight?this.textFontWeight:v.textFontWeight,a=null===v.textOrientation?this.textOrientation:v.textOrientation,o=null===v.textAlignment?this.textAlignment:v.textAlignment,r=null===v.textDirection?this.textDirection:v.textDirection,s=null===v.textMargin?this.textMargin:v.textMargin,l=null===v.textFillStyle?this.textFillStyle:v.textFillStyle,g=null===v.textStrokeStyle?this.textStrokeStyle:v.textStrokeStyle,m=null===v.textLineWidth?this.textLineWidth:v.textLineWidth,t*=this.scaleFactor,s*=this.scaleFactor;let k='';null!=n&&(k+=n+' '),null!=t&&(k+=t+'px '),null!=e&&(k+=e),this.ctx.font=k,this.ctx.fillStyle=l,this.ctx.strokeStyle=g,this.ctx.lineWidth=m;let T=v.text.split('\n'),w=0-t*(T.length/2)+t/2;'curved'==a&&('inner'==o||'outer'==o)&&(w=0);for(let F=0;F<T.length;F++){if('reversed'==r){if('horizontal'==a){this.ctx.textAlign='inner'==o?'right':'outer'==o?'left':'center',this.ctx.textBaseline='middle';let b=this.degToRad(v.endAngle-(v.endAngle-v.startAngle)/2+this.rotationAngle-90-180);this.ctx.save(),this.ctx.translate(p,f),this.ctx.rotate(b),this.ctx.translate(-p,-f),'inner'==o?(l&&this.ctx.fillText(T[F],p-A-s,f+w),g&&this.ctx.strokeText(T[F],p-A-s,f+w)):'outer'==o?(l&&this.ctx.fillText(T[F],p-h+s,f+w),g&&this.ctx.strokeText(T[F],p-h+s,f+w)):(l&&this.ctx.fillText(T[F],p-A-(h-A)/2-s,f+w),g&&this.ctx.strokeText(T[F],p-A-(h-A)/2-s,f+w)),this.ctx.restore()}else if('vertical'==a){this.ctx.textAlign='center',this.ctx.textBaseline='inner'==o?'top':'outer'==o?'bottom':'middle';let b=v.endAngle-(v.endAngle-v.startAngle)/2-180;b+=this.rotationAngle,this.ctx.save(),this.ctx.translate(p,f),this.ctx.rotate(this.degToRad(b)),this.ctx.translate(-p,-f);let R=0;'outer'==o?R=f+h-s:'inner'==o&&(R=f+A+s);let W=t-t/9;if('outer'==o)for(let _,I=T[F].length-1;0<=I;I--)_=T[F].charAt(I),l&&this.ctx.fillText(_,p+w,R),g&&this.ctx.strokeText(_,p+w,R),R-=W;else if('inner'==o)for(let _,I=0;I<T[F].length;I++)_=T[F].charAt(I),l&&this.ctx.fillText(_,p+w,R),g&&this.ctx.strokeText(_,p+w,R),R+=W;else if('center'==o){let I=0;1<T[F].length&&(I=W*(T[F].length-1)/2);let _=f+A+(h-A)/2+I+s;for(let D,C=T[F].length-1;0<=C;C--)D=T[F].charAt(C),l&&this.ctx.fillText(D,p+w,_),g&&this.ctx.strokeText(D,p+w,_),_-=W}this.ctx.restore()}else if('curved'==a){let b=0;'inner'==o?(b=A+s,this.ctx.textBaseline='top'):'outer'==o?(b=h-s,this.ctx.textBaseline='bottom',b-=t*(T.length-1)):'center'==o&&(b=A+s+(h-A)/2,this.ctx.textBaseline='middle');let R=0,W=0;if(1<T[F].length){this.ctx.textAlign='left',R=4*(t/10);let I=100/b;R*=I;let _=R*T[F].length;W=v.startAngle+((v.endAngle-v.startAngle)/2-_/2)}else W=v.startAngle+(v.endAngle-v.startAngle)/2,this.ctx.textAlign='center';W+=this.rotationAngle,W-=180;for(let I=T[F].length;0<=I;I--){this.ctx.save();let _=T[F].charAt(I);this.ctx.translate(p,f),this.ctx.rotate(this.degToRad(W)),this.ctx.translate(-p,-f),g&&this.ctx.strokeText(_,p,f+b+w),l&&this.ctx.fillText(_,p,f+b+w),W+=R,this.ctx.restore()}}}else if('horizontal'==a){this.ctx.textAlign='inner'==o?'left':'outer'==o?'right':'center',this.ctx.textBaseline='middle';let b=this.degToRad(v.endAngle-(v.endAngle-v.startAngle)/2+this.rotationAngle-90);this.ctx.save(),this.ctx.translate(p,f),this.ctx.rotate(b),this.ctx.translate(-p,-f),'inner'==o?(l&&this.ctx.fillText(T[F],p+A+s,f+w),g&&this.ctx.strokeText(T[F],p+A+s,f+w)):'outer'==o?(l&&this.ctx.fillText(T[F],p+h-s,f+w),g&&this.ctx.strokeText(T[F],p+h-s,f+w)):(l&&this.ctx.fillText(T[F],p+A+(h-A)/2+s,f+w),g&&this.ctx.strokeText(T[F],p+A+(h-A)/2+s,f+w)),this.ctx.restore()}else if('vertical'==a){this.ctx.textAlign='center',this.ctx.textBaseline='inner'==o?'bottom':'outer'==o?'top':'middle';let b=v.endAngle-(v.endAngle-v.startAngle)/2;b+=this.rotationAngle,this.ctx.save(),this.ctx.translate(p,f),this.ctx.rotate(this.degToRad(b)),this.ctx.translate(-p,-f);let R=0;'outer'==o?R=f-h+s:'inner'==o&&(R=f-A-s);let W=t-t/9;if('outer'==o)for(let _,I=0;I<T[F].length;I++)_=T[F].charAt(I),l&&this.ctx.fillText(_,p+w,R),g&&this.ctx.strokeText(_,p+w,R),R+=W;else if('inner'==o)for(let _,I=T[F].length-1;0<=I;I--)_=T[F].charAt(I),l&&this.ctx.fillText(_,p+w,R),g&&this.ctx.strokeText(_,p+w,R),R-=W;else if('center'==o){let I=0;1<T[F].length&&(I=W*(T[F].length-1)/2);let _=f-A-(h-A)/2-I-s;for(let D,C=0;C<T[F].length;C++)D=T[F].charAt(C),l&&this.ctx.fillText(D,p+w,_),g&&this.ctx.strokeText(D,p+w,_),_+=W}this.ctx.restore()}else if('curved'==a){let b=0;'inner'==o?(b=A+s,this.ctx.textBaseline='bottom',b+=t*(T.length-1)):'outer'==o?(b=h-s,this.ctx.textBaseline='top'):'center'==o&&(b=A+s+(h-A)/2,this.ctx.textBaseline='middle');let R=0,W=0;if(1<T[F].length){this.ctx.textAlign='left',R=4*(t/10);let I=100/b;R*=I;let _=R*T[F].length;W=v.startAngle+((v.endAngle-v.startAngle)/2-_/2)}else W=v.startAngle+(v.endAngle-v.startAngle)/2,this.ctx.textAlign='center';W+=this.rotationAngle;for(let I=0;I<T[F].length;I++){this.ctx.save();let _=T[F].charAt(I);this.ctx.translate(p,f),this.ctx.rotate(this.degToRad(W)),this.ctx.translate(-p,-f),g&&this.ctx.strokeText(_,p,f-b+w),l&&this.ctx.fillText(_,p,f-b+w),W+=R,this.ctx.restore()}}w+=t}}this.ctx.restore()}}},Winwheel.prototype.degToRad=function(e){return 0.017453292519943295*e},Winwheel.prototype.setCenter=function(e,t){this.centerX=e,this.centerY=t},Winwheel.prototype.addSegment=function(e,t){let n=new Segment(e);this.numSegments++;let a;if('undefined'!=typeof t){for(let o=this.numSegments;o>t;o--)this.segments[o]=this.segments[o-1];this.segments[t]=n,a=t}else this.segments[this.numSegments]=n,a=this.numSegments;return this.updateSegmentSizes(),this.segments[a]},Winwheel.prototype.setCanvasId=function(e){e?(this.canvasId=e,this.canvas=document.getElementById(this.canvasId),this.canvas&&(this.ctx=this.canvas.getContext('2d'))):(this.canvasId=null,this.ctx=null,this.canvas=null)},Winwheel.prototype.deleteSegment=function(e){if(1<this.numSegments){if('undefined'!=typeof e)for(let t=e;t<this.numSegments;t++)this.segments[t]=this.segments[t+1];this.segments[this.numSegments]=void 0,this.numSegments--,this.updateSegmentSizes()}},Winwheel.prototype.windowToCanvas=function(e,t){let n=this.canvas.getBoundingClientRect();return{x:Math.floor(e-n.left*(this.canvas.width/n.width)),y:Math.floor(t-n.top*(this.canvas.height/n.height))}},Winwheel.prototype.getSegmentAt=function(e,t){let n=null,a=this.getSegmentNumberAt(e,t);return null!==a&&(n=this.segments[a]),n},Winwheel.prototype.getSegmentNumberAt=function(e,t){let a,o,r,s,l,n=this.windowToCanvas(e,t),g=this.centerX*this.scaleFactor,m=this.centerY*this.scaleFactor,u=this.outerRadius*this.scaleFactor,p=this.innerRadius*this.scaleFactor;n.x>g?(r=n.x-g,o='R'):(r=g-n.x,o='L'),n.y>m?(s=n.y-m,a='B'):(s=m-n.y,a='T');let f=s/r,h=180*Math.atan(f)/Math.PI,A=0;if(l=Math.sqrt(s*s+r*r),'T'==a&&'R'==o?A=Math.round(90-h):'B'==a&&'R'==o?A=Math.round(h+90):'B'==a&&'L'==o?A=Math.round(90-h+180):'T'==a&&'L'==o&&(A=Math.round(h+270)),0!=this.rotationAngle){let v=this.getRotationPosition();A-=v,0>A&&(A=360-Math.abs(A))}let S=null;for(let v=1;v<=this.numSegments;v++)if(A>=this.segments[v].startAngle&&A<=this.segments[v].endAngle&&l>=p&&l<=u){S=v;break}return S},Winwheel.prototype.getIndicatedSegment=function(){let e=this.getIndicatedSegmentNumber();return this.segments[e]},Winwheel.prototype.getIndicatedSegmentNumber=function(){let e=0,t=this.getRotationPosition(),n=Math.floor(this.pointerAngle-t);0>n&&(n=360-Math.abs(n));for(let a=1;a<this.segments.length;a++)if(n>=this.segments[a].startAngle&&n<=this.segments[a].endAngle){e=a;break}return e},Winwheel.prototype.getCurrentPinNumber=function(){let e=0;if(this.pins){let t=this.getRotationPosition(),n=Math.floor(this.pointerAngle-t);0>n&&(n=360-Math.abs(n));let a=360/this.pins.number,o=0;for(let r=0;r<this.pins.number;r++){if(n>=o&&n<=o+a){e=r;break}o+=a}'clockwise'==this.animation.direction&&(e++,e>this.pins.number&&(e=0))}return e},Winwheel.prototype.getRotationPosition=function(){let e=this.rotationAngle;if(!(0<=e)){if(-360>e){let t=Math.ceil(e/360);e-=360*t}e=360+e}else if(360<e){let t=Math.floor(e/360);e-=360*t}return e},Winwheel.prototype.startAnimation=function(){if(this.animation){this.computeAnimation(),winwheelToDrawDuringAnimation=this;let e=[null];e[this.animation.propertyName]=this.animation.propertyValue,e.yoyo=this.animation.yoyo,e.repeat=this.animation.repeat,e.ease=this.animation.easing,e.onUpdate=winwheelAnimationLoop,e.onComplete=winwheelStopAnimation,this.tween=TweenMax.to(this,this.animation.duration,e)}},Winwheel.prototype.stopAnimation=function(e){winwheelToDrawDuringAnimation&&(winwheelToDrawDuringAnimation.tween&&winwheelToDrawDuringAnimation.tween.kill(),winwheelStopAnimation(e)),winwheelToDrawDuringAnimation=this},Winwheel.prototype.pauseAnimation=function(){this.tween&&this.tween.pause()},Winwheel.prototype.resumeAnimation=function(){this.tween&&this.tween.play()},Winwheel.prototype.computeAnimation=function(){if(this.animation)if('spinOngoing'==this.animation.type)this.animation.propertyName='rotationAngle',null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=-1),null==this.animation.easing&&(this.animation.easing='Linear.easeNone'),null==this.animation.yoyo&&(this.animation.yoyo=!1),this.animation.propertyValue=360*this.animation.spins,'anti-clockwise'==this.animation.direction&&(this.animation.propertyValue=0-this.animation.propertyValue);else if('spinToStop'==this.animation.type){if(this.animation.propertyName='rotationAngle',null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=0),null==this.animation.easing&&(this.animation.easing='Power3.easeOut'),null==this.animation.stopAngle){var e=Math.floor(359*Math.random());let n=Math.round(Math.random()*1e3);0<n&&n<=+this.segments[this.getIndicatedSegmentNumberByRawAngle(e)].tlt?this.animation._stopAngle=e:this.computeAnimation()}else this.animation._stopAngle=360-this.animation.stopAngle+this.pointerAngle;null==this.animation.yoyo&&(this.animation.yoyo=!1),this.animation.propertyValue=360*this.animation.spins,'anti-clockwise'==this.animation.direction?(this.animation.propertyValue=0-this.animation.propertyValue,this.animation.propertyValue-=360-this.animation._stopAngle):this.animation.propertyValue+=this.animation._stopAngle}else if('spinAndBack'==this.animation.type)this.animation.propertyName='rotationAngle',null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=1),null==this.animation.easing&&(this.animation.easing='Power2.easeInOut'),null==this.animation.yoyo&&(this.animation.yoyo=!0),this.animation._stopAngle=null==this.animation.stopAngle?0:360-this.animation.stopAngle,this.animation.propertyValue=360*this.animation.spins,'anti-clockwise'==this.animation.direction?(this.animation.propertyValue=0-this.animation.propertyValue,this.animation.propertyValue-=360-this.animation._stopAngle):this.animation.propertyValue+=this.animation._stopAngle;else if('custom'==this.animation.type);},Winwheel.prototype.getRandomForSegment=function(e){let t=0;if(!e)console.log('Segment number not specified');else if('undefined'!=typeof this.segments[e]){let n=this.segments[e].startAngle,a=this.segments[e].endAngle,o=a-n-2;0<o?t=n+1+Math.floor(Math.random()*o):console.log('Segment size is too small to safely get random angle inside it')}else console.log('Segment '+e+' undefined');return t};function Pin(e){let t={visible:!0,number:36,outerRadius:3,fillStyle:'grey',strokeStyle:'black',lineWidth:1,margin:3,responsive:!1};for(let n in t)this[n]=null!=e&&'undefined'!=typeof e[n]?e[n]:t[n];if(null!=e)for(let n in e)'undefined'==typeof this[n]&&(this[n]=e[n])}function Animation(e){let t={type:'spinOngoing',direction:'clockwise',propertyName:null,propertyValue:null,duration:10,yoyo:!1,repeat:null,easing:null,stopAngle:null,spins:null,clearTheCanvas:null,callbackFinished:null,callbackBefore:null,callbackAfter:null,callbackSound:null,soundTrigger:'segment'};for(let n in t)this[n]=null!=e&&'undefined'!=typeof e[n]?e[n]:t[n];if(null!=e)for(let n in e)'undefined'==typeof this[n]&&(this[n]=e[n])}function Segment(e){let t={size:null,text:'',fillStyle:null,strokeStyle:null,lineWidth:null,textFontFamily:null,textFontSize:null,textFontWeight:null,textOrientation:null,textAlignment:null,textDirection:null,textMargin:null,textFillStyle:null,textStrokeStyle:null,textLineWidth:null,image:null,imageDirection:null,imgData:null,tlt:null};for(let n in t)this[n]=null!=e&&'undefined'!=typeof e[n]?e[n]:t[n];if(null!=e)for(let n in e)'undefined'==typeof this[n]&&(this[n]=e[n]);this.startAngle=0,this.endAngle=0}Segment.prototype.changeImage=function(e,t){this.image=e,this.imgData=null,t&&(this.imageDirection=t),winhweelAlreadyDrawn=!1,this.imgData=new Image,this.imgData.onload=winwheelLoadedImage,this.imgData.src=this.image};function PointerGuide(e){let t={display:!1,strokeStyle:'red',lineWidth:3};for(let n in t)this[n]=null!=e&&'undefined'!=typeof e[n]?e[n]:t[n]}function winwheelPercentToDegrees(e){let t=0;if(0<e&&100>=e){t=360*(e/100)}return t}function winwheelAnimationLoop(){if(winwheelToDrawDuringAnimation){!1!=winwheelToDrawDuringAnimation.animation.clearTheCanvas&&winwheelToDrawDuringAnimation.ctx.clearRect(0,0,winwheelToDrawDuringAnimation.canvas.width,winwheelToDrawDuringAnimation.canvas.height);let callbackBefore=winwheelToDrawDuringAnimation.animation.callbackBefore,callbackAfter=winwheelToDrawDuringAnimation.animation.callbackAfter;null!=callbackBefore&&('function'==typeof callbackBefore?callbackBefore():eval(callbackBefore)),winwheelToDrawDuringAnimation.draw(!1),null!=callbackAfter&&('function'==typeof callbackAfter?callbackAfter():eval(callbackAfter)),winwheelToDrawDuringAnimation.animation.callbackSound&&winwheelTriggerSound()}}function winwheelTriggerSound(){!1==winwheelToDrawDuringAnimation.hasOwnProperty('_lastSoundTriggerNumber')&&(winwheelToDrawDuringAnimation._lastSoundTriggerNumber=0);let callbackSound=winwheelToDrawDuringAnimation.animation.callbackSound,currentTriggerNumber=0;currentTriggerNumber='pin'==winwheelToDrawDuringAnimation.animation.soundTrigger?winwheelToDrawDuringAnimation.getCurrentPinNumber():winwheelToDrawDuringAnimation.getIndicatedSegmentNumber(),currentTriggerNumber!=winwheelToDrawDuringAnimation._lastSoundTriggerNumber&&('function'==typeof callbackSound?callbackSound():eval(callbackSound),winwheelToDrawDuringAnimation._lastSoundTriggerNumber=currentTriggerNumber)}let winwheelToDrawDuringAnimation=null;function winwheelStopAnimation(canCallback){if(!1!=canCallback){let callback=winwheelToDrawDuringAnimation.animation.callbackFinished;null!=callback&&('function'==typeof callback?callback(winwheelToDrawDuringAnimation.getIndicatedSegment()):eval(callback))}}let winhweelAlreadyDrawn=!1;function winwheelLoadedImage(){if(!1==winhweelAlreadyDrawn){let e=0;for(let t=1;t<=winwheelToDrawDuringAnimation.numSegments;t++)null!=winwheelToDrawDuringAnimation.segments[t].imgData&&winwheelToDrawDuringAnimation.segments[t].imgData.height&&e++;e==winwheelToDrawDuringAnimation.numSegments&&(winhweelAlreadyDrawn=!0,winwheelToDrawDuringAnimation.draw())}}function winwheelResize(){let e=40;'undefined'!=typeof winwheelToDrawDuringAnimation._responsiveMargin&&(e=winwheelToDrawDuringAnimation._responsiveMargin);let t=window.innerWidth-e,n=winwheelToDrawDuringAnimation._responsiveMinWidth,a=winwheelToDrawDuringAnimation._responsiveMinHeight;t<n?t=n:t>winwheelToDrawDuringAnimation._originalCanvasWidth&&(t=winwheelToDrawDuringAnimation._originalCanvasWidth);let o=t/winwheelToDrawDuringAnimation._originalCanvasWidth;if(winwheelToDrawDuringAnimation.canvas.width=winwheelToDrawDuringAnimation._originalCanvasWidth*o,winwheelToDrawDuringAnimation._responsiveScaleHeight){let r=winwheelToDrawDuringAnimation._originalCanvasHeight*o;r<a?r=a:r>winwheelToDrawDuringAnimation._originalCanvasHeight&&(r=winwheelToDrawDuringAnimation._originalCanvasHeight),winwheelToDrawDuringAnimation.canvas.height=r}winwheelToDrawDuringAnimation.scaleFactor=o,winwheelToDrawDuringAnimation.draw()}Winwheel.prototype.getIndicatedSegmentNumberByRawAngle=function(e){let t=0;e=360<e?e:e-360;let n=Math.floor(this.pointerAngle-e);0>n&&(n=360-Math.abs(n));for(let a=1;a<this.segments.length;a++)if(n>=this.segments[a].startAngle&&n<=this.segments[a].endAngle){t=a;break}return t};